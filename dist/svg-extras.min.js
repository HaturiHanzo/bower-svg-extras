!function(t){"use strict";if(!inherit)throw new Error("Svg-extras requires https://github.com/dfilatov/inherit");var e="ontouchstart"in document.documentElement;t.svgext={_isTouchDevice:e,_throttleEventListener:function(t,e,n){var r=!1,i=!1;n=n||window;var o=function(t){return!r&&(r=!0,void requestAnimationFrame(function(){i||e(t),r=!1}))};return n.addEventListener(t,o,!1),function(){i=!0,n.removeEventListener(t,o)}},"default":{control:{width:12,height:12},borderedRect:{borderOffset:14}}}}(window);
!function(t){"use strict";t.SVGElement=inherit({NS:"http://www.w3.org/2000/svg",__constructor:function(t,e){this.rootNode=this.node="string"==typeof e?this.createElem(e):e,t=t||{},t.cssClass&&this.addClass(t.cssClass),t.backgroundColor?this.attr("fill",t.backgroundColor):this.addClass("svg_bg-color_default"),this.on("dragstart",function(t){t.preventDefault()})},hasClass:function(t){var e=this.attr("class");return!!e&&new RegExp("(\\s|^)"+t+"(\\s|$)").test(e)},addClass:function(t){return t.split(/\s+/).forEach(function(t){if(!this.hasClass(t)){var e=this.attr("class")||"";this.attr("class",e+" "+t)}},this),this},removeClass:function(t){var e=this.node.getAttribute("class");if(e){var n=new RegExp("(?:(\\s|^))"+t+"(?=\\s|$)","g");this.attr("class",e.replace(n,""))}return this},hide:function(){return this.addClass("svg-element_hidden")},show:function(){return this.removeClass("svg-element_hidden")},attr:function(t,e){return void 0===e?this.node.getAttribute(t):(this.node.setAttribute(t,e),this)},bringToFront:function(){var t=this.rootNode.parentNode;return t.removeChild(this.rootNode),t.appendChild(this.rootNode),this},activate:function(){return this.isActive=!0,this.addClass("active"),this},deactivate:function(){return this.isActive=!1,this.removeClass("active")},on:function(t,e){return this.node.addEventListener(t,e),this},onDoubleTap:function(t){var e=!1,n=function(n){e?(clearTimeout(e),e=null,n.stopPropagation(),t(n)):e=setTimeout(function(){e=null},300)};return this.on("touchstart",n),n},offDoubleTap:function(t){return this.off("touchstart",t)},off:function(t,e){return this.node.removeEventListener(t,e),this},getContainerRect:function(){return this.node.ownerSVGElement.getBoundingClientRect()},getRect:function(){return this.node.getBoundingClientRect()},destroy:function(){Object.keys(this).forEach(function(t){delete this[t]},this)},createElem:function(t){return document.createElementNS(this.NS,t)},onAppend:function(t){this.container=t}})}(svgext);
!function(t){"use strict";t.SVGBlock={__constructor:function(){this.__base.apply(this,arguments),this.children=[]},append:function(t){return this.children.push(t),t.container=this,this.appendElem(t.rootNode),t.onAppend(this),this},appendElem:function(t){this.rootNode.appendChild(t)},remove:function(t){if(t)return t.isActive&&this.deactivateActiveElement&&this.deactivateActiveElement(),this.children.splice(this.children.indexOf(t),1),this.removeElem(t.rootNode),t.destroy(),this},removeElem:function(t){this.rootNode.removeChild(t)},hide:function(){this.__base(),this.children.forEach(function(t){t.hide()})},show:function(){this.__base(),this.children.forEach(function(t){t.show()})}}}(svgext);
!function(e){"use strict";e.SVGDraggable={__constructor:function(n){this.__base.apply(this,arguments),(n.isDraggable||void 0===n.isDraggable)&&(this._dndOnMouseMove=this._dndOnMouseMove.bind(this),this._dndOnMouseUp=this._dndOnMouseUp.bind(this),this.addClass("svg_draggable"),this.on(e._isTouchDevice?"touchstart":"mousedown",this._dndOnMouseDown.bind(this)))},destroy:function(){this.removeDndHandlers&&this.removeDndHandlers(),this.__base()},removeDndHandlers:function(){e._isTouchDevice?(window.removeEventListener("touchmove",this._dndOnMouseMove),window.removeEventListener("touchcancel",this._dndOnMouseUp),window.removeEventListener("touchend",this._dndOnMouseUp)):(window.removeEventListener("mousemove",this._dndOnMouseMove),window.removeEventListener("mouseup",this._dndOnMouseUp))},_dndOnMouseDown:function(n){n.which&&3===n.which||n.button&&2===n.button||(document.body.classList.add("unselectable"),this._saveClientCoords(n.changedTouches?n.changedTouches[0]:n),e._isTouchDevice?(window.addEventListener("touchmove",this._dndOnMouseMove),window.addEventListener("touchend",this._dndOnMouseUp),window.addEventListener("touchcancel",this._dndOnMouseUp)):(window.addEventListener("mousemove",this._dndOnMouseMove),window.addEventListener("mouseup",this._dndOnMouseUp)))},_dndOnMouseMove:function(e){if(void 0!==e.movementX)return this.drag(this.normalizeCoords({x:e.movementX,y:e.movementY}));var n=e;return n.changedTouches&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),n=e.changedTouches[0]),this._lastClientCoords?(this.drag(this.normalizeCoords({x:n.clientX-this._lastClientCoords.clientX,y:n.clientY-this._lastClientCoords.clientY})),void this._saveClientCoords(n)):this._saveClientCoords(n)},_saveClientCoords:function(e){this._lastClientCoords={clientX:e.clientX,clientY:e.clientY}},_dndOnMouseUp:function(){this._lastClientCoords=null,this.removeDndHandlers(),document.body.classList.remove("unselectable")},drag:function(){throw new Error("SVGDraggable.drag not implemented")},normalizeCoords:function(){throw new Error("SVGDraggable.normalizeCoords not implemented")}}}(svgext);
!function(t){"use strict";t.SVGContainer=inherit([t.SVGElement,t.SVGBlock],{__constructor:function(e){e=e||{},e.isDraggable=!1,e.cssClass=e.cssClass||"svg-container_fluid",this.__base(e,e.node||"svg"),this._offWindowResize=t._throttleEventListener("resize",this._onWindowResize.bind(this))},getInstances:function(t){return t?this._filterChildren(t):this.children},getActiveElement:function(){return this.activeElement},toggleAllInstances:function(t,e){return this.getInstances(e).forEach(function(e){t?e.show():e.deactivate().hide()}),this},setActiveElement:function(e){e&&e instanceof t.SVGElement&&!e.isActive&&(this.deactivateActiveElement(),e.activate(),this.activeElement=e)},deactivateActiveElement:function(){return this.activeElement&&(this.activeElement.deactivate(),this.activeElement=null),this},removeActiveInstance:function(t){this.activeElement&&(!t||t&&this.activeElement instanceof t)&&(this.remove(this.activeElement),this.activeElement=null)},removeAllInstances:function(t){var e=this.children;if(t)return this.removeActiveInstance(t),this.getInstances(t).forEach(this.remove,this);for(this.activeElement=null;e.length;)this.remove(e[0])},destroy:function(){this._offWindowResize(),this.__base()},_filterChildren:function(t){return this.children.filter(function(e){return e instanceof t})},_onWindowResize:function(){var t=this.getRect();return void 0===this._prevContainerWidth?(this._prevContainerWidth=t.width,void(this._prevContainerHeight=t.height)):void(t.width===this._prevContainerWidth&&t.height===this._prevContainerHeight||(this._resizeChildren(t.width/this._prevContainerWidth,t.height/this._prevContainerHeight),this._prevContainerWidth=t.width,this._prevContainerHeight=t.height))},_resizeChildren:function(t,e){this.children.forEach(function(i){i&&i.resize&&i.resize(t,e)})}})}(svgext);
!function(t){"use strict";t.SVGRect=inherit([t.SVGElement,t.SVGDraggable],{__constructor:function(t){t||(t={}),this.__base(t,"rect"),void 0!==t.width&&this.width(t.width),void 0!==t.height&&this.height(t.height),void 0!==t.x&&this.setX(t.x),void 0!==t.y&&this.setY(t.y)},setX:function(t){return this._rectX=t||0,this.attr("x",this._rectX)},getX:function(){return this._rectX},setY:function(t){return this._rectY=t||0,this.attr("y",this._rectY)},getY:function(){return this._rectY},width:function(t){return void 0===t?this._width:(this._width=t,this.attr("width",this._width))},height:function(t){return void 0===t?this._height:(this._height=t,this.attr("height",this._height))},normalizeCoords:function(t){var i=this.getX(),h=this.getY(),e=this.width(),s=this.height(),r=this.getContainerRect();return i+t.x<0?t.x=-1*i:i+e+t.x>r.width&&(t.x=r.width-i-e),h+t.y<0?t.y=-1*h:h+s+t.y>r.height&&(t.y=r.height-h-s),t},getValue:function(t){var i,h={width:this.width(),height:this.height()};return t&&(i=this.getContainerRect(),h.width/=i.width,h.height/=i.height),h},drag:function(t){this.setX(this.getX()+t.x).setY(this.getY()+t.y)}})}(svgext);
!function(t){"use strict";t.CartesianGeometryMath={distanceBtwTwoPoints:function(t,n){return Math.sqrt(Math.pow(n[0]-t[0],2)+Math.pow(n[1]-t[1],2))},lineSegmentMidPoint:function(t){return[t[0][0]+(t[1][0]-t[0][0])/2,t[0][1]+(t[1][1]-t[0][1])/2]},checkLinesIntersection:function(t,n){return this._arePointsCounterClockWise(t[0],n[0],n[1])!==this._arePointsCounterClockWise(t[1],n[0],n[1])&&this._arePointsCounterClockWise(t[0],t[1],n[0])!==this._arePointsCounterClockWise(t[0],t[1],n[1])},findPolygonInsertIndex:function(t,n){var e,i=Number.POSITIVE_INFINITY,s=this.generateLineSegments(t);return s.forEach(function(t,o){var r=this.lineSegmentMidPoint(t),c=this.distanceBtwTwoPoints(r,n);if(i>c){var u,h=s.slice();h.splice(o,1),u=h.some(function(t){return this.checkLinesIntersection(t,[r,n])},this),u||(i=c,e=o+1)}},this),e},generateLineSegments:function(t){for(var n=[],e=0;e<=t.length-4;e+=2)n.push([[t[e],t[e+1]],[t[e+2],t[e+3]]]);return n.push([[t[t.length-2],t[t.length-1]],[t[0],t[1]]]),n},_arePointsCounterClockWise:function(t,n,e){return(e[1]-t[1])*(n[0]-t[0])>(n[1]-t[1])*(e[0]-t[0])}}}(svgext);
!function(t){"use strict";t.SVGPolygonVertex=inherit(t.SVGRect,{__constructor:function(i){i=i?i:{isDraggable:!0},this.__base(i),t._isTouchDevice&&this.addClass("svg-control_type_touch")},normalizeCoords:function(t){var i=this.getX(),e=this.getY(),h=this.getContainerRect();return i+t.x<0?t.x=-1*i:i+t.x>h.width&&(t.x=h.width-i),e+t.y<0?t.y=-1*e:e+t.y>h.height&&(t.y=h.height-e),t},drag:function(t){this.__base(t),this.container.render()},setX:function(t){return this._rectX=t-this.width()/2,this.attr("x",this._rectX)},getX:function(){return this._rectX+this.width()/2},setY:function(t){return this._rectY=t-this.height()/2,this.attr("y",this._rectY)},getY:function(){return this._rectY+this.height()/2}})}(svgext);
!function(t){"use strict";var e=[t.SVGElement,t.SVGBlock,t.SVGDraggable];t.SVGPolygon=inherit(e,{__constructor:function(e){e=e||{},e.cssClass=e.cssClass||"svg-polygon",this.__base(e,"polygon"),this.rootNode=this.createElem("g"),this.appendElem(this.node),e.points&&this.setPoints(e.points),this.on(t._isTouchDevice?"touchstart":"mousedown",this.select.bind(this))},onAppend:function(e){return this.__base(e),this._onContainerDblClick=this._onContainerDblClick.bind(this),t._isTouchDevice?this._onContainerDblClick=this.container.onDoubleTap(this._onContainerDblClick):void this.container.on("dblclick",this._onContainerDblClick)},destroy:function(){t._isTouchDevice?this.container.offDoubleTap(this._onContainerDblClick):this.container.off("dblclick",this._onContainerDblClick),this.__base()},setPoints:function(t){if(t&&Array.isArray(t)&&t.length%2===0){this.vertexes&&this.vertexes.forEach(this.remove,this),this.vertexes=[];for(var e=0;e<t.length-1;e+=2)this.vertexes.push(this._createVertex([t[e],t[e+1]]));this.render()}return this},render:function(){return this.attr("points",this.vertexes.reduce(function(t,e){return t.push(e.getX()+","+e.getY()),t},[]).join(" ")),this},addPoint:function(e){var i=this.getValue(!1);if(i&&i.length){var n=this._createVertex(e).addClass("active");this.vertexes.splice(t.CartesianGeometryMath.findPolygonInsertIndex(i,e),0,n),this.render()}return this},normalizeCoords:function(t){return this.vertexes.forEach(function(e){t=e.normalizeCoords(t)}),t},drag:function(t){this.vertexes.forEach(function(e){e.setX(e.getX()+t.x),e.setY(e.getY()+t.y)}),this.render()},activate:function(){return this.__base(),this.vertexes.forEach(function(t){t.activate()}),this.bringToFront(),this},deactivate:function(){return this.__base(),this.vertexes.forEach(function(t){t.deactivate()}),this},isSimple:function(e){for(var i=t.CartesianGeometryMath.generateLineSegments(this.getValue(!1)),n=i.length,s=0;s<n-2;s++)for(var r=s+2;r<n-(s>0?0:1);r++)if(t.CartesianGeometryMath.checkLinesIntersection(i[s],i[r]))return e&&this.select(),!1;return!0},getValue:function(t){var e=this.getContainerRect();return this.vertexes.reduce(function(i,n){return t?i.push(n.getX()/e.width,n.getY()/e.height):i.push(n.getX(),n.getY()),i},[])},resize:function(t,e){this.vertexes.forEach(function(i){i.setX(i.getX()*t),i.setY(i.getY()*e)}),this.render()},select:function(){return this.container.setActiveElement(this),this},_removeVertex:function(t){this.vertexes.length<4||(this.vertexes.splice(this.vertexes.indexOf(t),1),this.remove(t).render())},_createVertex:function(e){var i=new t.SVGPolygonVertex({width:t["default"].control.width,height:t["default"].control.height,x:e[0],y:e[1],cssClass:"svg-polygon-vertex"}),n=function(t){this._removeVertex(i),t.stopPropagation()}.bind(this);return this.append(i),t._isTouchDevice?i.onDoubleTap(n):i.on("dblclick",n),i},_onContainerDblClick:function(e){if(this.isActive){var i=this.getContainerRect(),n=t._isTouchDevice?[e.changedTouches[0].clientX-i.left,e.changedTouches[0].clientY-i.top]:[e.offsetX,e.offsetY];this.addPoint(n)}}})}(svgext);
!function(t){"use strict";t.SVGRectControls=inherit(t.SVGRect,{__constructor:function(e){if(!e.type)throw new Error("Type should be set in a SVGRectControls constructor");this.__base(e),this.type=e.type,this.addClass("svg-rectangle-control_type_"+this.type),t._isTouchDevice&&this.addClass("svg-control_type_touch")},normalizeCoords:function(t){var e=this.width(),i=this.height(),s=this.getX()+e/2,h=this.getY()+i/2,o=this.getContainerRect();return s+t.x<0?t.x=-1*s:s+t.x>o.width&&(t.x=o.width-s),h+t.y<0?t.y=-1*h:h+t.y>o.height&&(t.y=o.height-h),t},drag:function(t){t["horizontal"===this.type?"y":"x"]=0,this.__base(t),this.container.update(this.type)}})}(svgext);
!function(t){"use strict";var e=[t.SVGRect,t.SVGBlock];t.SVGResizableRect=inherit(e,{__constructor:function(e){if(!(e.width&&e.height&&e.x&&e.y))throw new Error("Missing property. Properties:width, height, x and y are required by SVGResizableRectangle.");e.cssClass=e.cssClass||"svg-resizable-rectangle",this.__base(e),this.rootNode=this.createElem("g"),this.appendElem(this.node),this._createControls(),this.on(t._isTouchDevice?"touchstart":"mousedown",this.select.bind(this))},update:function(e){var i,s=this.controls;if("vertical"===e){i=s[0].getY()>=s[1].getY()?1:0,this.setY(t["default"].control.height/2+s[i].getY()),this.height(s[i?0:1].getY()-s[i].getY());var h=this.getY()+this.height()/2-t["default"].control.height/2;[s[2],s[3]].forEach(function(t){t.setY(h)})}else{i=s[2].getX()>=s[3].getX()?3:2,this.setX(t["default"].control.width/2+s[i].getX()),this.width(s[3===i?2:3].getX()-s[i].getX());var o=this.getX()+this.width()/2-t["default"].control.width/2;[s[0],s[1]].forEach(function(t){t.setX(o)})}},activate:function(){return this.__base(),this.controls.forEach(function(t){t.activate()}),this.bringToFront(),this},deactivate:function(){return this.__base(),this.controls.forEach(function(t){t.deactivate()}),this},drag:function(t){this.controls.concat(this).forEach(function(e){e.setX(e.getX()+t.x).setY(e.getY()+t.y)})},select:function(){return this.container.setActiveElement(this),this},resize:function(t,e){this.setX(this.getX()*t),this.setY(this.getY()*e),this.width(this.width()*t),this.height(this.height()*e),this.controls.forEach(function(i){i.setX(i.getX()*t).setY(i.getY()*e)},this)},_addControl:function(e){var i=new t.SVGRectControls(e);this.append(i),this.controls.push(i)},_createControls:function(){if(!this.controlCreated){this.controls=[];var e=t["default"].control.width/2,i=t["default"].control.height/2,s={width:t["default"].control.width,height:t["default"].control.height,cssClass:"svg-rectangle-control"};return s.type="vertical",s.x=this.getX()+this.width()/2-e,s.y=this.getY()-i,this._addControl(s),s.y=this.getY()+this.height()-i,this._addControl(s),s.type="horizontal",s.x=this.getX()+this.width()-e,s.y=this.getY()+this.height()/2-i,this._addControl(s),s.x=this.getX()-e,this._addControl(s),this.controlCreated=!0,this}}})}(svgext);
!function(t){"use strict";t.SVGBorder=inherit(t.SVGElement,{__constructor:function(){this.__base({isDraggable:!1,cssClass:"svg-border",backgroundColor:"none"},"rect")},onAppend:function(t){this.__base(t),this.render()},render:function(e){var r=t["default"].borderedRect.borderOffset;"x"!==e&&this.attr("y",this.container.getY()-r).attr("height",this.container.height()+2*r),"y"!==e&&this.attr("x",this.container.getX()-r).attr("width",this.container.width()+2*r)}})}(svgext);
!function(t){"use strict";t.SVGBorderControl=inherit(t.SVGRect,{__constructor:function(){this.__base({cssClass:"svg-border-control",isDraggable:!0,width:t["default"].control.width,height:t["default"].control.width}),t._isTouchDevice&&this.addClass("svg-control_type_touch")},onAppend:function(t){this.__base(t),this.render()},normalizeCoords:function(t){var e=this.getContainerRect(),i=this.container;return i.width()+t.x<1?t.x=i.width()>1?-1*(i.width()-1):0:i.getX()+i.width()+t.x>e.width&&(t.x=e.width-i.getX()-i.width()),i.height()+t.y<1?t.y=i.height()>1?-1*i.height()+1:0:i.getY()+i.height()+t.y>e.height&&(t.y=e.height-i.getY()-i.height()),t},drag:function(t){var e=this.container;e.width(e.width()+t.x).height(e.height()+t.y)},render:function(e){var i=this.container,h=t["default"].borderedRect.borderOffset;"x"!==e&&this.setY(i.getY()+i.height()+h-t["default"].control.height/2),"y"!==e&&this.setX(i.getX()+i.width()+h-t["default"].control.width/2)}})}(svgext);
!function(t){"use strict";t.SVGBorderedRect=inherit([t.SVGRect,t.SVGBlock],{__constructor:function(e){if(!(e.width&&e.height&&e.x&&e.y))throw new Error("Missing property. Properties:width, height, x and y are required by SVGResizeableRectangle.");e.cssClass=e.cssClass||"svg-bordered-rect",this.__base(e),this.rootNode=this.createElem("g"),this.appendElem(this.node),this.border=new t.SVGBorder,this.append(this.border),this.control=new t.SVGBorderControl,this.append(this.control),this.on(t._isTouchDevice?"touchstart":"mousedown",this.select.bind(this))},width:function(t){var e=this.__base(t);return t&&this.renderComponents("x"),e},height:function(t){var e=this.__base(t);return t&&this.renderComponents("y"),e},activate:function(){return this.__base(),this.border.activate(),this.control.activate(),this.bringToFront(),this},deactivate:function(){return this.__base(),this.border.deactivate(),this.control.deactivate(),this},drag:function(t){this.setX(this.getX()+t.x).setY(this.getY()+t.y),this.renderComponents()},select:function(){return this.container.setActiveElement(this),this},resize:function(t,e){this.setX(this.getX()*t),this.setY(this.getY()*e),this.width(this.width()*t),this.height(this.height()*e),this.renderComponents()},renderComponents:function(t){this.border&&this.control&&(this.border.render(t),this.control.render(t))}})}(svgext);